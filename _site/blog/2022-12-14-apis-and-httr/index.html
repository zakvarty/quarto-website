<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zak Varty">
<meta name="dcterms.date" content="2022-12-14">
<meta name="description" content="Part 2 of a mini-series on aquiring data from the web, focusing on data aquisition via APIs.">

<title>Zak Varty - Aquiring Data via an API</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/00_favicon/favicon.ico" rel="icon">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-29RLTHLZB5"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-29RLTHLZB5', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>


<meta name="twitter:title" content="Zak Varty - Aquiring Data via an API">
<meta name="twitter:description" content="Part 2 of a mini-series on aquiring data from the web, focusing on data aquisition via APIs.">
<meta name="twitter:image" content="https://www.zakvarty.com/blog/2022-12-14-apis-and-httr/apis-and-httr.png">
<meta name="twitter:image-height" content="900">
<meta name="twitter:image-width" content="900">
<meta name="twitter:image:alt" content="The text APIs and httr, written on a black hexagon.">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Zak Varty</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-professional" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Professional</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-professional">    
        <li>
    <a class="dropdown-item" href="../../professional/research.html" rel="" target="">
 <span class="dropdown-text">Research</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../professional/teaching.html" rel="" target="">
 <span class="dropdown-text">Teaching</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../professional/talks.html" rel="" target="">
 <span class="dropdown-text">Talks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../professional/bookmarks.html" rel="" target="">
 <span class="dropdown-text">Bookmarks</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-personal" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Personal</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-personal">    
        <li>
    <a class="dropdown-item" href="../../personal/reading-record.html" rel="" target="">
 <span class="dropdown-text">Reading record 📚</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.twitter.com/zakvarty" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zakvarty" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#aquiring-data-part-2---using-apis" id="toc-aquiring-data-part-2---using-apis" class="nav-link active" data-scroll-target="#aquiring-data-part-2---using-apis">Aquiring Data: Part 2 - Using APIs</a></li>
  <li><a href="#why-do-i-need-to-know-about-apis" id="toc-why-do-i-need-to-know-about-apis" class="nav-link" data-scroll-target="#why-do-i-need-to-know-about-apis">Why do I need to know about APIs?</a></li>
  <li><a href="#what-is-an-api" id="toc-what-is-an-api" class="nav-link" data-scroll-target="#what-is-an-api">What is an API?</a></li>
  <li><a href="#http" id="toc-http" class="nav-link" data-scroll-target="#http">HTTP</a></li>
  <li><a href="#http-requests" id="toc-http-requests" class="nav-link" data-scroll-target="#http-requests">HTTP Requests</a>
  <ul class="collapse">
  <li><a href="#url" id="toc-url" class="nav-link" data-scroll-target="#url">URL</a></li>
  <li><a href="#method" id="toc-method" class="nav-link" data-scroll-target="#method">Method</a></li>
  <li><a href="#header" id="toc-header" class="nav-link" data-scroll-target="#header">Header</a></li>
  <li><a href="#body" id="toc-body" class="nav-link" data-scroll-target="#body">Body</a></li>
  </ul></li>
  <li><a href="#http-responses" id="toc-http-responses" class="nav-link" data-scroll-target="#http-responses">HTTP Responses</a>
  <ul class="collapse">
  <li><a href="#status-codes" id="toc-status-codes" class="nav-link" data-scroll-target="#status-codes">Status Codes</a></li>
  </ul></li>
  <li><a href="#authentication" id="toc-authentication" class="nav-link" data-scroll-target="#authentication">Authentication</a>
  <ul class="collapse">
  <li><a href="#basic-authentication" id="toc-basic-authentication" class="nav-link" data-scroll-target="#basic-authentication">Basic Authentication</a></li>
  <li><a href="#api-key-authentication" id="toc-api-key-authentication" class="nav-link" data-scroll-target="#api-key-authentication">API Key Authentication</a></li>
  </ul></li>
  <li><a href="#api-wrappers" id="toc-api-wrappers" class="nav-link" data-scroll-target="#api-wrappers">API wrappers</a></li>
  <li><a href="#geonames-wrapper" id="toc-geonames-wrapper" class="nav-link" data-scroll-target="#geonames-wrapper"><code>{geonames}</code> wrapper</a>
  <ul class="collapse">
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set up</a></li>
  </ul></li>
  <li><a href="#keep-it-secret-keep-it-safe" id="toc-keep-it-secret-keep-it-safe" class="nav-link" data-scroll-target="#keep-it-secret-keep-it-safe">Keep it Secret, Keep it Safe</a></li>
  <li><a href="#using-geonames" id="toc-using-geonames" class="nav-link" data-scroll-target="#using-geonames">Using <code>{geonames}</code></a></li>
  <li><a href="#what-if-there-is-no-wrapper" id="toc-what-if-there-is-no-wrapper" class="nav-link" data-scroll-target="#what-if-there-is-no-wrapper">What if there is no wrapper?</a></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up">Wrapping up</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Aquiring Data via an API</h1>
  <div class="quarto-categories">
    <div class="quarto-category">data science</div>
    <div class="quarto-category">data acquisition</div>
    <div class="quarto-category">tutorial</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>Part 2 of a mini-series on aquiring data from the web, focusing on data aquisition via APIs.</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://www.zakvarty.com/">Zak Varty</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 14, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="aquiring-data-part-2---using-apis" class="level2">
<h2 class="anchored" data-anchor-id="aquiring-data-part-2---using-apis">Aquiring Data: Part 2 - Using APIs</h2>
<div class="medium_right">
<p><img style="border-radius: 10%;" src="apis-and-httr.png" alt="The text APIs and httr, written on a black hexagon."></p>
</div>
<p>You can’t always rely on tidy, tabular data to land on your desk. Sometimes you are going to have to go out and gather data for yourself.</p>
<p>I’m not suggesting you will need to do this manually, but you will likely need to get data from the internet that’s been made publicly or privately available to you.</p>
<p>This might be information from a webpage that you gather yourself, or data shared with you by a collaborator using an API.</p>
<p>In this second blog post we will cover the basics of obtaining data via an API. This material draws together the <a href="https://zapier.com/learn/apis/">Introduction to APIs</a> book by Brian Cooksey and the <a href="https://stat545.com/diy-web-data.html#interacting-with-an-api">DIY web data</a> section of STAT545 at the University of British Columbia.</p>
</section>
<section id="why-do-i-need-to-know-about-apis" class="level2">
<h2 class="anchored" data-anchor-id="why-do-i-need-to-know-about-apis">Why do I need to know about APIs?</h2>
<blockquote class="blockquote">
<p>An API, or application programming interface, is a set of rules that allows different software applications to communicate with each other.</p>
</blockquote>
<p>As a data scientist, you will often need to access data that is stored on remote servers or in cloud-based services. APIs provide a convenient way for data scientists to programmatically retrieve this data, without having to manually download data sets or and process them locally on their own computer.</p>
<p>This has multiple benefits including automation and standardisation of data sharing.</p>
<ul>
<li><p><strong>Automation:</strong> It is much faster for a machine to process a data request than a human. Having a machine handling data requests also scales much better as either the number or the complexity of data requests grows. Additionally, there is a lower risk of introducing human error. For example, a human might accidentally share the wrong data, which can have serious legal repercussions.</p></li>
<li><p><strong>Standardisation:</strong> Having a machine process data requests requires the format of these requests and the associated responses to be standardised. This allows data sharing and retrieval to become a reproducible and programmatic aspect of our work.</p></li>
</ul>
</section>
<section id="what-is-an-api" class="level2">
<h2 class="anchored" data-anchor-id="what-is-an-api">What is an API?</h2>
<p>So then, if APIs are so great, what exactly are they?</p>
<p>In human-to-human communication, the set of rules governing acceptable behaviour is known as etiquette. Depending on when or where you live, social etiquette can be rather strict. The rules for computer-to-computer communication take this to a whole new level, because with machines there can be no room left for interpretation.</p>
<p>The set of rules governing interactions between computers or programmes is known as a <strong>protocol</strong>.</p>
<p>APIs provide a standard protocol for different programs to interact with one another. This makes it easier for developers to build complex systems by leveraging the functionality of existing services and platforms. The benefits of working in a standardised and modular way apply equally well to sharing data as they do to writing code or organising files.</p>
<p>There are two sides to communication and when <em>machines</em> communicate these are known as the <strong>server</strong> and the <strong>client</strong>.</p>
<div class="medium_right">
<p><img style="border-radius: 10%;" src="server-schematic.png" alt="Schematic diagram representing a computer server. Text above reads 'Servers: don't fear a computer with no screen'."></p>
</div>
<p>Servers can seem intimidating, because unlike your laptop or mobile phone they don’t have their own input and output devices; they have no keyboard, no monitor, and no a mouse. Despite this, servers are just regular computers that are designed to store data and run programmes. Servers don’t have their own input or output devices because they are intended to be used <em>remotely</em>, via another computer. There is no need for a screen or a mouse if the user is miles away. Nothing scary going on here!</p>
<p>People often find clients much less intimidating - they are simply any other computer or application that might contact the sever.</p>
</section>
<section id="http" class="level2">
<h2 class="anchored" data-anchor-id="http">HTTP</h2>
<p>This leads us one step further down the rabbit-hole. An API is a protocol that defines the rules of how applications communicate with one another. But how does this communication happen?</p>
<p>HTTP (Hypertext Transfer Protocol) is the dominant mode communication on the World Wide Web. You can see the secure version of HTTP, HTTPS, at the start of most web addresses up at the top of your browser. For example:</p>
<pre class="http"><code>https://www.zakvarty.com/blog</code></pre>
<p>HTTP is the foundation of data communication on the web and is used to transfer files (such as text, images, and videos) between web servers and clients.</p>
<div class="medium_left">
<p><img style="border-radius: 10%;" src="request-response.png" alt="Schematic diagram showing a request being sent from a client to a server, which returns a response."></p>
</div>
<p>To understand HTTP communications, I find it helpful to imagine the client and the server as being a customer and a waiter at a restaurant. The client makes some request to the server, which then tries to comply before giving a response. The server might respond to confirm that the request was completed successfully. Alternatively, the server might respond with an error message, which is (hopefully) informative about why the request could not be completed.</p>
<p>This request-response model is the basis for HTTP, the communication system used by the majority of APIs.</p>
</section>
<section id="http-requests" class="level2">
<h2 class="anchored" data-anchor-id="http-requests">HTTP Requests</h2>
<p>An HTML request consists of:</p>
<ul>
<li>Uniform Resource Locator (URL) [unique identifier for a thing]</li>
<li>Method [tells server the type of action requested by client]</li>
<li>Headers [meta-information about request, e.g.&nbsp;device type]</li>
<li>Body [Data the client wants to send to the server]</li>
</ul>
<div class="medium_right">
<p><img style="border-radius: 10%;" src="html-request.png" alt="Schematic diagram showing the structure of an HTML request, composed of: a URL, method, headers and body."></p>
</div>
<section id="url" class="level3">
<h3 class="anchored" data-anchor-id="url">URL</h3>
<p>The URL in a HTTP request specifies where that request is going to be made, for example <code>http://example.com</code>.</p>
</section>
<section id="method" class="level3">
<h3 class="anchored" data-anchor-id="method">Method</h3>
<p>The action that the client wants to take is indicated by a set of well-defined methods or HTTP verbs. The most common HTTP verbs are <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, and <code>DELETE</code>.</p>
<p>The <code>GET</code> verb is used to retrieve a resource from the server, such as a web page or an image. The <code>POST</code> verb is used to send data to the server, such as when submitting a form or uploading a file. The <code>PUT</code> verb is used to replace a resource on the server with a new one, while the <code>PATCH</code> verb is used to update a resource on the server without replacing it entirely. Finally, the <code>DELETE</code> verb is used to delete a resource from the server.</p>
<p>In addition to these common HTTP verbs, there are also several less frequently used verbs. These are used for specialized purposes, such as requesting only the headers of a resource, or testing the connectivity between the client and the server.</p>
</section>
<section id="header" class="level3">
<h3 class="anchored" data-anchor-id="header">Header</h3>
<p>The request headers contain meta-information about the request. This is where information about the device type would be included within the request.</p>
</section>
<section id="body" class="level3">
<h3 class="anchored" data-anchor-id="body">Body</h3>
<p>Finally, the body of the request contains the data that the client is providing to the server.</p>
</section>
</section>
<section id="http-responses" class="level2">
<h2 class="anchored" data-anchor-id="http-responses">HTTP Responses</h2>
<p>When the server receives a request it will attempt to fulfil it and then send a response back to the client.</p>
<div class="medium_left">
<p><img style="border-radius: 10%;" src="html-response.png" alt="Schematic diagram showing the structure of an HTML response, composed of: a status code, headers and body."></p>
</div>
<p>A response has a similar structure to a request apart from:</p>
<ul>
<li>responses <strong>do not have</strong> a URL,</li>
<li>responses <strong>do not have</strong> a method,</li>
<li>responses <strong>have</strong> a status code.</li>
</ul>
<section id="status-codes" class="level3">
<h3 class="anchored" data-anchor-id="status-codes">Status Codes</h3>
<p>The status code is a 3 digit number, each of which has a specific meaning. Some common error codes that you might (already have) come across are:</p>
<ul>
<li>200: Success,</li>
<li>404: Page not found (all 400s are errors),</li>
<li>503: Page down.</li>
</ul>
<p>In a data science context, a successful response will return the requested data within the data field. This will most likely be given in JSON or XML format.</p>
</section>
</section>
<section id="authentication" class="level2">
<h2 class="anchored" data-anchor-id="authentication">Authentication</h2>
<p>Now that we know <em>how</em> applications communicate, you might ask how we can control who has access to the API and what types of request they can make. This can be done by the server setting appropriate permissions for each client. But then how does the server verify that the client is really who is claims to be?</p>
<p><strong>Authentication</strong> is a way to ensure that only authorized clients are able to access an API. This is typically done by the server requiring each client to provide some secret information that uniquely identifies them, whenever they make requests to the API. This information allows the API server to validate the authenticity this user before it authorises the request.</p>
<section id="basic-authentication" class="level3">
<h3 class="anchored" data-anchor-id="basic-authentication">Basic Authentication</h3>
<p>There are various ways to implement API authentication.</p>
<p>Basic authentication involves each legitimate client having a username and password. An encrypted version of these is included in the <code>Authorization</code> header of the HTTP request. If the hear matches with the server’s records then the request is processed. If not, then a special status code (401) is returned to the client.</p>
<p>Basic authentication is dangerous because it does not put any restrictions on what a client can do once they are authorised. Additional, individualised restrictions can be added by using an alternative authentication scheme.</p>
</section>
<section id="api-key-authentication" class="level3">
<h3 class="anchored" data-anchor-id="api-key-authentication">API Key Authentication</h3>
<p>An API key is long, random string of letters and numbers that is assigned to each authorised user. An API key is distinct from the user’s password and keys are typically issued by the service that provides an API. Using keys rather than basic authentication allows the API provider to track and limit the usage of their API.</p>
<p>For example, a provider may issue a unique API key to each developer or organization that wants to use the API. The provider can then limit access to certain data. They could also limit the number of requests that each key can make in a given time period or prevent access to certain administrative functions, like changing passwords or deleting accounts.</p>
<p>Unlike Basic Authentication, there is no standard way of a client sharing a key with the server. Depending on the API this might be in the <code>Authorization</code> field of the header, at the end of the URL (<code>http://example.com?api_key=my_secret_key</code>), or within the body of the data.</p>
</section>
</section>
<section id="api-wrappers" class="level2">
<h2 class="anchored" data-anchor-id="api-wrappers">API wrappers</h2>
<p>We’ve learned a lot about how the internet works. Fortunately, a lot of the time we won’t have to worry about all of that new information other than for debugging purposes.</p>
<p>In the best case scenario, a very kind developer has written a “wrapper” function for the API. These wrappers are functions in R that will construct the HTML request for you. If you are particularly lucky, the API wrapper will also format the response for you, converting it from XML or JSON back into an R object that is ready for immediate use.</p>
</section>
<section id="geonames-wrapper" class="level2">
<h2 class="anchored" data-anchor-id="geonames-wrapper"><code>{geonames}</code> wrapper</h2>
<p><a href="https://ropensci.org/">rOpenSci</a> has a curated list of many wrappers for accessing scientific data using R. We will focus on the <a href="https://www.geonames.org/">GeoNames API</a>, which gives open access to a geographical database. To access this data, we will use wrapper functions provided by the <code>{geonames}</code> <a href="https://docs.ropensci.org/geonames/">package</a>.</p>
<p>The aim here is to illustrate the important steps of getting started with a new API.</p>
<section id="set-up" class="level3">
<h3 class="anchored" data-anchor-id="set-up">Set up</h3>
<p>Before we can get any data from the GeoNames API, we first need to do a little bit of set up.</p>
<ol type="1">
<li>Install and load <code>{geonames}</code> from CRAN</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("geonames")</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geonames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Create a user account for the GeoNames API</li>
</ol>
<p><img style="border-radius: 0%;" src="sign-up.png" alt="Screenshot of the GeoNames login page. Example text has been added in the fields to create a new user account."></p>
<ol start="3" type="1">
<li>Activate the account (see activation email)</li>
</ol>
<p><img style="border-radius: 0%;" src="confirmation-email.png" alt="Screenshot of the GeoNames confirmation email, which gives a link to click in order to confirm the new account."></p>
<ol start="4" type="1">
<li><p>Enable the free web services for your GeoNames account by logging in at this <a href="http://www.geonames.org/enablefreewebservice">link</a>.</p></li>
<li><p>Tell R your credentials for GeoNames.</p></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>We could use the following code to tell R our credentials, but we absolutely should not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">geonamesUsername=</span><span class="st">"example_username"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This would save our username as an environment variable, but it <em>also</em> puts our API credentials directly into the script. If we share the script with our others (internally, externally or publicly) we would be sharing our credentials too. Not good!</p>
</div>
</div>
</section>
</section>
<section id="keep-it-secret-keep-it-safe" class="level2">
<h2 class="anchored" data-anchor-id="keep-it-secret-keep-it-safe">Keep it Secret, Keep it Safe</h2>
<p>The solution to this problem is to add our credentials as environment variables in our <code>.Rprofile</code> rather than in this script. The <code>.Rprofile</code> is an R script that is run at the start of every session. IT can be created and edited directly, but can also be created and edited from within R.</p>
<p>To make/open your <code>.Rprofile</code> use the <code>edit_r_profile()</code> function from the <code>{usethis}</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(usethis)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_profile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Within this file, add <code>options(geonamesUsername="example_username")</code> on a new line, remembering to replace <code>example_username</code> with your own GeoNames username.</p>
<p>The final step is to <strong>check this this file ends with a blank line</strong>, save it and restart R. Then we are all set to start using <code>{geonames}</code>.</p>
<p>This set up procedure is indicative of most API wrappers, but of course the details will vary between each API. This is why good documentation is important!</p>
</section>
<section id="using-geonames" class="level2">
<h2 class="anchored" data-anchor-id="using-geonames">Using <code>{geonames}</code></h2>
<p>GeoNames has a whole host of <a href="http://www.geonames.org/export/ws-overview.html">different geo-datasets</a> that you can explore. As a first example, let’s get all of the geo-tagged wikipedia articles that are within 1km of Imperial College London.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>imperial_coords <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">lat =</span> <span class="fl">51.49876</span>, <span class="at">lon =</span> <span class="sc">-</span><span class="fl">0.1749</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>search_radius_km <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>imperial_neighbours <span class="ot">&lt;-</span> geonames<span class="sc">::</span><span class="fu">GNfindNearbyWikipedia</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> imperial_coords<span class="sc">$</span>lat,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lng =</span> imperial_coords<span class="sc">$</span>lon, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> search_radius_km,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lang =</span> <span class="st">"en"</span>,                <span class="co"># english language articles</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxRows =</span> <span class="dv">500</span>              <span class="co"># maximum number of results to return </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the structure of <code>imperial_neighbours</code> we can see that it is a data frame with one row per geo-tagged wikipedia article.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(imperial_neighbours)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   204 obs. of  13 variables:
 $ summary     : chr  "The Department of Mechanical Engineering is responsible for teaching and research in mechanical engineering at "| __truncated__ "Imperial College Business School is a global business school located in London. The business school was opened "| __truncated__ "Exhibition Road is a street in South Kensington, London which is home to several major museums and academic est"| __truncated__ "Imperial College School of Medicine (ICSM) is the medical school of Imperial College London in England, and one"| __truncated__ ...
 $ elevation   : chr  "20" "18" "19" "24" ...
 $ feature     : chr  "edu" "edu" "landmark" "edu" ...
 $ lng         : chr  "-0.1746" "-0.1748" "-0.17425" "-0.1757" ...
 $ distance    : chr  "0.0335" "0.0494" "0.0508" "0.0558" ...
 $ rank        : chr  "81" "91" "90" "96" ...
 $ lang        : chr  "en" "en" "en" "en" ...
 $ title       : chr  "Department of Mechanical Engineering, Imperial College London" "Imperial College Business School" "Exhibition Road" "Imperial College School of Medicine" ...
 $ lat         : chr  "51.498524" "51.4992" "51.4989722222222" "51.4987" ...
 $ wikipediaUrl: chr  "en.wikipedia.org/wiki/Department_of_Mechanical_Engineering%2C_Imperial_College_London" "en.wikipedia.org/wiki/Imperial_College_Business_School" "en.wikipedia.org/wiki/Exhibition_Road" "en.wikipedia.org/wiki/Imperial_College_School_of_Medicine" ...
 $ countryCode : chr  NA "AE" NA "GB" ...
 $ thumbnailImg: chr  NA NA NA NA ...
 $ geoNameId   : chr  NA NA NA NA ...</code></pre>
</div>
</div>
<p>To confirm we have the correct location we can inspect the title of the first five neighbours.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>imperial_neighbours<span class="sc">$</span>title[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Department of Mechanical Engineering, Imperial College London"             
[2] "Imperial College Business School"                                          
[3] "Exhibition Road"                                                           
[4] "Imperial College School of Medicine"                                       
[5] "Department of Civil and Environmental Engineering, Imperial College London"</code></pre>
</div>
</div>
<p>Nothing too surprising here, mainly departments of the college and Exhibition Road, which runs along one side of the campus. These sorts of check are important - I initially forgot the minus in the longitude and was getting results in East London!</p>
</section>
<section id="what-if-there-is-no-wrapper" class="level2">
<h2 class="anchored" data-anchor-id="what-if-there-is-no-wrapper">What if there is no wrapper?</h2>
<p>If there is not a wrapper function, we can still access APIs fairly easilty using the <code>{httr}</code> package.</p>
<p>We will look at an example using <a href="http://www.omdbapi.com/">OMDb</a>, which is an open source version of <a href="https://www.imdb.com/">IMDb</a>, to get information about the movie Mean Girls.</p>
<p>To use the OMDB API you will once again need to <a href="http://www.omdbapi.com/apikey.aspx">request a free API key</a>, follow a verification link and add your API key to your <code>.Rprofile</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to .Rprofile, pasting in your own API key</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">OMDB_API_Key =</span> <span class="st">"PASTE YOUR KEY HERE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can then restart R and safely access your API key from within your R session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load your API key into the current R session,</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ombd_api_key <span class="ot">&lt;-</span> <span class="fu">getOption</span>(<span class="st">"OMDB_API_Key"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the documentation for the API, requests have URLs of the following form, where terms in angular brackets should be replaced by you.</p>
<pre><code>http://www.omdbapi.com/?t=&lt;TITLE&gt;&amp;y=&lt;YEAR&gt;&amp;plot=&lt;LENGTH&gt;&amp;r=&lt;FORMAT&gt;&amp;apikey=&lt;API_KEY&gt;</code></pre>
<p>With a little bit of effort, we can write a function that composes this type of request URL for us. We will using the <code>{glue}</code> package to help us join strings together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Compose search requests for the OMBD API</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param title String defining title to search for. Words are separated by "+".</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param year String defining release year to search for</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param plot String defining whether "short" or "full" plot is returned</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param format String defining return format. One of "json" or "xml"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param api_key String defining your OMDb API key.</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return String giving a OMBD search request URL</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples </span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' omdb_url("mean+girls", "2004", "short", "json", getOption(OMBD_API_Key))</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>omdb_url <span class="ot">&lt;-</span> <span class="cf">function</span>(title, year, plot, format, api_key) {</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"http://www.omdbapi.com/?t={title}&amp;y={year}&amp;plot={plot}&amp;r={format}&amp;apikey={api_key}"</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Running the example we get:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mean_girls_request <span class="ot">&lt;-</span> <span class="fu">omdb_url</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"mean+girls"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span>  <span class="st">"2004"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> <span class="st">"short"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span>  <span class="st">"json"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span>  <span class="fu">getOption</span>(<span class="st">"OMDB_API_Key"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then use the <code>{httr}</code> package to construct our request and store the response we get.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="at">url =</span> mean_girls_request)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>httr<span class="sc">::</span><span class="fu">status_code</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 200</code></pre>
</div>
</div>
<p>Thankfully it was a success! If you get a 401 error code here, check that you have clicked the activation link for your API key.</p>
<p>The full structure of the response is quite complicated, but we can easily extract the requested data using <code>content()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>httr<span class="sc">::</span><span class="fu">content</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Title
[1] "Mean Girls"

$Year
[1] "2004"

$Rated
[1] "PG-13"

$Released
[1] "30 Apr 2004"

$Runtime
[1] "97 min"

$Genre
[1] "Comedy"

$Director
[1] "Mark Waters"

$Writer
[1] "Rosalind Wiseman, Tina Fey"

$Actors
[1] "Lindsay Lohan, Jonathan Bennett, Rachel McAdams"

$Plot
[1] "Cady Heron is a hit with The Plastics, the A-list girl clique at her new school, until she makes the mistake of falling for Aaron Samuels, the ex-boyfriend of alpha Plastic Regina George."

$Language
[1] "English, German, Vietnamese, Swahili"

$Country
[1] "United States, Canada"

$Awards
[1] "7 wins &amp; 25 nominations"

$Poster
[1] "https://m.media-amazon.com/images/M/MV5BMjE1MDQ4MjI1OV5BMl5BanBnXkFtZTcwNzcwODAzMw@@._V1_SX300.jpg"

$Ratings
$Ratings[[1]]
$Ratings[[1]]$Source
[1] "Internet Movie Database"

$Ratings[[1]]$Value
[1] "7.1/10"


$Ratings[[2]]
$Ratings[[2]]$Source
[1] "Rotten Tomatoes"

$Ratings[[2]]$Value
[1] "84%"


$Ratings[[3]]
$Ratings[[3]]$Source
[1] "Metacritic"

$Ratings[[3]]$Value
[1] "66/100"



$Metascore
[1] "66"

$imdbRating
[1] "7.1"

$imdbVotes
[1] "385,107"

$imdbID
[1] "tt0377092"

$Type
[1] "movie"

$DVD
[1] "21 Sep 2004"

$BoxOffice
[1] "$86,058,055"

$Production
[1] "N/A"

$Website
[1] "N/A"

$Response
[1] "True"</code></pre>
</div>
</div>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping up</h2>
<p>We have learned a bit more about how the internet works, the benefits of using an API to share data and how to request data from Open APIs.</p>
<p>When obtaining data from the internet it’s vital that you keep your credentials safe, and that don’t do more work than is needed.</p>
<ul>
<li><p>Keep your API keys out of your code. Store them in your <code>.Rprofile</code> (and make sure this is not under version control!)</p></li>
<li><p>Scraping is always a last resort. Is there an API already?</p></li>
<li><p>Writing your own code to access an API can be more painful than necessary.</p></li>
<li><p>Don’t repeat other people, if a suitable wrapper exists then use it.</p></li>
</ul>


</section>

<div id="quarto-appendix"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{varty2022,
  author = {Varty, Zak},
  title = {Aquiring {Data} via an {API}},
  date = {2022-12-14},
  url = {https://www.zakvarty.com/blog/2022-12-14-apis-and-httr},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-varty2022" class="csl-entry quarto-appendix-citeas" role="listitem">
Varty, Zak. 2022. <span>“Aquiring Data via an API.”</span> December 14,
2022. <a href="https://www.zakvarty.com/blog/2022-12-14-apis-and-httr">https://www.zakvarty.com/blog/2022-12-14-apis-and-httr</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Zak Varty.</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.twitter.com/zakvarty">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zakvarty">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=3H4vg4cAAAAJ&amp;hl=en&amp;oi=ao">
      <i class="bi bi-google" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>